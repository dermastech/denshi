<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>はたらく妖精さん</title>
  <script>
    var img = new Array();
    img[0] = new Image(); //画像オブジェクト作成
    img[0].src = "pic/building_music_gakki.png"; //写真のパスを指定する
    img[1] = new Image();
    img[1].src = "pic/business_bag.png";
    img[2] = new Image();
    img[2].src = "pic/dna_idenshi_kumikae_corn.png";
    img[3] = new Image();
    img[3].src = "pic/fish_buri2.png";
    img[4] = new Image();
    img[4].src = "pic/game_software_cassette.png";
    img[5] = new Image();
    img[5].src = "pic/omochaya_man.png";
    img[6] = new Image();
    img[6].src = "pic/suijou_cottage.png";
    img[7] = new Image();
    img[7].src = "pic/tokugawa_ieyasu.png";
    img[8] = new Image();
    img[8].src = "pic/tree_animals_group.png";
    img[9] = new Image();
    img[9].src = "pic/sports_takkyu_men.png";
    img[10] = new Image();
    img[10].src = "pic/boy_01.png";
    img[11] = new Image();
    img[11].src = "pic/girl_13.png";
    img[12] = new Image();
    img[12].src = "pic/icon_business_woman01.png";
    img[13] = new Image();
    img[13].src = "pic/icon_medical_man08.png";
    img[14] = new Image();
    img[14].src = "pic/man_58.png";
    img[15] = new Image();
    img[15].src = "pic/oldwoman_93.png";
    img[16] = new Image();
    img[16].src = "pic/fantasy_pixy2.png";
    img[17] = new Image();
    img[17].src = "pic/computer_laptop_note_zabuton.png";
  </script>
</head>

<body onload="title()">
  <canvas id="cv3" width="960" height="600"></canvas>



  <script type="text/javascript">
    let x_before = 0,
      y_before = 0;
    let x_value, y_value, posi,x_value_c,y_value_c = 0,
      point = 0,
      time = 0;
    let come=12000,
    out = 1,
      speed=100,
      lane=[[200,500,800,1100],[-100,200,500,800],[200,500,800,1100],[-100,200,500,800]],
      topic=[[0,1,2,3],
      [4,5,6,7],
      [8,9,1,3],
      [5,7,9,2]],
      user_wait=[-1,-1,-1,-1,-1],
      user_want=[-1,-1,-1,-1,-1],
      user_face=[0,0,0,0,0],
      new_user,
      have=-1,
      next=15000,
      gameover=0,
      str1,str2,rnd;
      var timer1;
      let topicList = new Array();


    <!--
    var ctx = document.getElementById("cv3").getContext("2d");
    ctx.fillStyle = "rgba(200,200,200,1)";
    ctx.fillRect(0, 0, 960, 600)
    ctx.font = "140px MS明朝";
    ctx.fillStyle = "rgba(0,0,0,1)";
    ctx.fillText(point, 0, 530, 500);
    // 匿名関数内で実行

    function title(){
            timer2()
    }

    function timer2(){
            timer1=setInterval("timer()", 20);
    }

    function timer() {
      time++
      var ctx = document.getElementById("cv3").getContext("2d");
      ctx.fillStyle = "rgba(230,230,230,1)";
      ctx.fillRect(0, 0, 960, 600)

      ctx.fillStyle = "rgba(250,250,0,0.5)";
      ctx.lineWidth = 5;
      ctx.beginPath(); // 1.Pathで描画を開始する
      ctx.moveTo(0, 450); // 2.描画する位置を指定する
      ctx.lineTo(960, 450); // 3.指定座標まで線を引く
      ctx.stroke(); // 4.Canvas上に描画する
      for (var i=0;i < 4;i++) {
        ctx.beginPath();
        ctx.moveTo(192 * i + 192, 450);
        ctx.lineTo(192 * i + 192, 600);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(0, 100 * i + 100);
        ctx.lineTo(960, 100 * i + 100);
        ctx.stroke(); // 4.Canvas上に描画する
      }

      for(var j=0;j<4;j++){
        for(var i=0;i<4;i++){
        if(j==0){lane[j][i]-=(speed/70)}
        if(j==1){lane[j][i]+=(speed/55)}
        if(j==2){lane[j][i]-=(speed/40)}
        if(j==3){lane[j][i]+=(speed/30)}
        }
      }

      for(var j=0;j<4;j++){
        for(var i=0;i<4;i++){
        if((j==0|j==2)&&(lane[j][i]<-100)){lane[j][i]+=1200;topic[j][i]=topicget();loop=topic[j][i];point++}
        if((j==1|j==3)&&(lane[j][i]>1000)){lane[j][i]-=1200;topic[j][i]=topicget();loop=topic[j][i];point++}
var ctx = document.getElementById("cv3").getContext("2d");
        }
      }

      for (var i=0;i<5;i++) {
        if (user_wait[i]>=0) {user_wait[i]+=speed
          if(user_wait[i]>=60000){
            gameover=1;
          }
        }else if(user_wait[i]<-1){
          user_wait[i]-=speed
          if (user_wait[i]<-12000) {
            user_want[i]=-1;user_wait[i]=-1
          }
        }
      }

come+=speed;
if (come>=next){
  come-=next
  new_user=Math.floor(Math.random() * 5);
  if (user_want[new_user]==-1) {
    user_want[new_user]=Math.floor(Math.random() * 10)
    user_wait[new_user]=0
    user_face[new_user]=Math.floor(Math.random() * 6)+10
  }
  next=Math.floor(Math.random() * 12000)+6000
}


      for(var j=0;j<4;j++){
        for(var i=0;i<4;i++){
          ctx.drawImage(img[topic[j][i]], lane[j][i], 100*j, 100, 100);
        }
      }

      ctx.lineCap = "round";
for (var i=0;i<5;i++) {
  if (user_wait[i]>=0){
    ctx.lineWidth = 10;
    ctx.strokeStyle = "rgba(0,0,255,1)";
  ctx.drawImage(img[17], 192*i, 450, 100, 100);
  ctx.drawImage(img[user_face[i]], 192*i+110, 540, 60, 60);
  ctx.drawImage(img[user_want[i]], 192*i+95, 450, 90, 90);
  ctx.beginPath();
  ctx.arc(50+192*i, 490, 20,  Math.PI*1.5-user_wait[i]*Math.PI*2/60000, Math.PI*1.5, true);
  ctx.stroke();
}else if (user_wait[i]<-1) {
  ctx.lineWidth = 10;
  ctx.strokeStyle = "rgba(255,50,50,0.8)";
  ctx.drawImage(img[17], 192*i, 450, 100, 100);
  ctx.drawImage(img[user_face[i]], 192*i+110, 540, 60, 60);
  ctx.drawImage(img[user_want[i]], 192*i+95, 450, 90, 90);
  ctx.drawImage(img[user_want[i]], 192*i+20, 460, 60, 60);
  ctx.beginPath();
  ctx.arc(100+192*i, 525, 60,  0, Math.PI*2, true);
  ctx.stroke();

}

}
ctx.font = "40px MS明朝";
ctx.fillStyle = "rgba(0,0,0,1)";
ctx.fillText("score: "+((speed/4)-25), 380, 440, 500);
ctx.strokeStyle = "rgba(0,0,0,1)";
      ctx.drawImage(img[16], x_value - 20, y_value - 70, 100, 120);
      if (have!=-1) {
        ctx.drawImage(img[have], x_value - 40, y_value - 40, 60, 60);
      }

if (gameover==1){
  gameend();
}
    }

function topicget(){
  if (topicList.length > 0) {
    return topicList.shift()
  }else{
    topicList=[0,1,2,3,4,5,6,7,8,9]
    for (var i = 0; i < 40; i++) {
       rnd = Math.floor(Math.random() * 8);
       str1 = topicList[0];
       str2 = topicList[rnd];

      //配列の各要素を入れ替える
      topicList[rnd] = str1;
      topicList[0] = str2;
    }
    return topicList.shift()
  }
}

    function gameend() {
        var ctx = document.getElementById("cv3").getContext("2d");
      clearInterval(timer1);

      ctx.fillStyle = "rgba(200,200,200,1)";
      ctx.fillRect(0, 0, 960, 600)
      ctx.font = "120px MS明朝";
      ctx.fillStyle = "rgba(0,0,0,1)";
      ctx.fillText("404 NOT FOUND", 50, 200, 860);
      ctx.font = "80px MS明朝";
      ctx.fillText("SCORE : "+((speed/4)-25), 150, 500, 660);
      setTimeout("tweet()",2000)
    }

    function tweet() {
      location.href = "https://twitter.com/intent/tweet?text=残念ながら404 NOT FOUNDとなってしまいました。score:"+((speed/4)-25)+"  http://denshi.dermas.trap.show/&hashtags=traP3jam"
    }


    (function() {

      function MouseMove00Func(e) {
        x_value = e.clientX
        y_value = e.clientY

      }


      // ------------------------------------------------------------
      // イベントのリッスンを開始する
      // ------------------------------------------------------------
      // イベントリスナーに対応している

      if (document.addEventListener) {
        // マウスを移動するたびに実行されるイベント
        document.addEventListener("mousemove", MouseMove00Func);
      }

      document.body.addEventListener( "click", function( event ) {
      	 x_value_c = event.pageX ;
      	 y_value_c = event.pageY ;
         ;
         ;
         for(var j=0;j<4;j++){
           for(var i=0;i<4;i++){
             if(x_value_c>lane[j][i]&&x_value_c<lane[j][i]+100&&y_value_c>100*j&&y_value_c<100*j+100) {have=topic[j][i]};
           }
         }

           for(var i=0;i<5;i++){
             if(x_value_c>192*i&&x_value_c<192*i+192&&y_value_c>450&&y_value_c<600&&user_want[i]==have) {speed+=4;user_wait[i]=-2};
         }

      } ) ;

    })();
    //-->
  </script>
  <br>
  <br>
  <br> ・説明 <br>画面下部の人がページを探しています。 <br>電子の妖精であるあなたは、上部からページを探して届けてあげましょう！<br>
  <br> ・遊び方 <br>上の流れる絵(ページ)をクリックすると、妖精さんが持ちます。 <br>ページを必要としている人の上でクリックすると、ページを届けられます。<br>なお、ひとつページを届けるごとにゲームスピードが4%ずつ上昇します。<br>

</body>

</html>
